<script type="text/javascript">
    jQuery(document).ready(function(){
        // jQuery('.field').keydown(function(e){
        //    if (e.keyCode === 9) {
        //		e.preventDefault();
        //		jQuery(this).parents('table').next().find('.editable').click();
        //   }
        //  });
        jQuery('.editable').click(function(){
            jQuery('.field').each(function(i){
                this.previous().show();
                jQuery(this).hide();
            });
            this.hide();
            this.next().show();
        });
        jQuery('.field').blur(function(){
            this.hide();
            this.previous().show();
            this.previous().innerText = jQuery(this).val();
        });
        jQuery('textarea.field').elastic();
    });
</script>
<% form_for @rubric, :url => member_rubrics_path , :html => {:id => 'rubric_form'} do |f| %>
<div class="fields">
    <p>
        <label for="rubric_title">
            <%= I18n.t('rubrics.model.title') %>
        </label>
        <%= f.text_field :title, :class=>"fieldbox wide" -%>
    </p>
    <p>
        <label for="rubric_score">
            <%= I18n.t('rubrics.member.new.score.title') %>
        </label>
        <%= f.text_field :score -%>
    </p>
</div>
<table class="tableB">
    <thead>
        <tr>
            <th class="criterion">
                <%= link_to_remote I18n.t('rubrics.member.new.criteria.add'),
                :url => {:controller => :rubrics, :action => 'add_criterion'}, :method => :post,
                :html => {:class => 'add'},
                :with => "$('rubric_form').serialize()" %>
            </th>
            <th colspan=<%=@rubric.levels.size%>
                class="level"><%= link_to_remote I18n.t('rubrics.member.new.levels.add'),
                :url => {:controller => :rubrics, :action => 'add_level'}, :method => :post,
                :html => {:class => 'add'},
                :with => "$('rubric_form').serialize()" %>
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <% unless @rubric.criteria.blank? %>
            <th class="criterion">
            </th>
            <% end %>
            <% i = 0 %>
            <% f.fields_for :levels do |l| %>
            <th class="level">
                <% level = @rubric.levels[i] %>
                <span class="editable"><%=level.name.blank? ? "Enter level name" : level.name %></span>
                <%= l.text_field :name, :placeholder => "level name" , :class => "field",  :style => "display: none;" , :size => 20 %>
                <%= l.hidden_field :position, :value => i %>
                <span class="editable point"><%= trim(level.points) %></span>
                <%= l.text_field :points, :placeholder => "Points" , :class => "field",  :style => "display: none;", :size => 5 %>
                <%= link_to_remote image_tag("jeditable/delete.gif"),
                :url => {:controller => :rubrics, :action => 'remove_field', :position => i,:type => 'level' }, :method => :post,
                :html => {:class => "float_right"},
                :with => "$('rubric_form').serialize()" %>
                <% i+= 1 %>
            </th>
            <% end %>
        </tr>
        <% j = 0 %>
        <% f.fields_for :criteria do |c| %>
        <tr>
            <th class="criterion">
                <% criterion = @rubric.criteria[j] %>
                <span class="editable"><%= criterion.name.blank? ?  "Enter criterion name" : criterion.name %></span>
                <%= c.text_field :name, :title => "criterion name", :placeholder => "criterion name" , :class => "field",  :style => "display: none;", :size => 20 %>
				
                <span class="editable point"><%= trim(criterion.weightage) %></span>
                <%= c.text_field :weightage, :placeholder => "Weightage" , :class => "field point",  :style => "display: none;", :size => 5 %>%<%= link_to_remote image_tag("jeditable/delete.gif"),
                :url => {:controller => :rubrics, :action => 'remove_field', :position => j,:type => 'criterion'  }, :method => :post,
                :html => {:class => "float_right"},
                :with => "$('rubric_form').serialize()" %>
				
				<div class="editable"><%= criterion.description.blank? ? "Description[optional]" :  criterion.description %></div>
                <%= c.text_area :description, :placeholder => "Describe criterion" , :class => "field",  :style => "display: none;" %>
            </th>
            <% k = 0 %>
            <% c.fields_for :rubric_descriptors do |rd| %>
            <td>
                <span class="editable"><%= @rubric.criteria[j].rubric_descriptors[k].description.blank? ? "Type description here.." :  @rubric.criteria[j].rubric_descriptors[k].description %></span>
                <%= rd.text_area :description, :placeholder => "Type description here..." , :class => "field",  :style => "display: none;" %>
                <%= rd.hidden_field :position, :value => k %>
                <% k+= 1 %>
            </td>
            <% end %>
        </tr>
        <% j+= 1 %>
        <% end %>
    </tbody>
</table>
<div class="actions">
    <%= submit_tag I18n.t('rubrics.member.index.create'), {:class => "button mainaction", :accesskey => "s"} %>
</div>
<% end %>