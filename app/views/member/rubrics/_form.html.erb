<script type="text/javascript">
    jQuery(document).ready(function(){
        jQuery('.editable').click(function(){
            this.hide();
            this.next().show();
        });
        jQuery('.field').blur(function(){
            this.hide();
            this.previous().show();
			this.previous().innerText = jQuery(this).val();
        });
    });
</script>
<% form_for @rubric, :url => member_rubrics_path , :html => {:id => 'rubric_form'} do |f| %>
<p>
    <label for="rubric_title">
        <%= I18n.t('rubrics.model.title') %>
    </label>
    <%= f.text_field :title, :class=>"fieldbox wide" -%>
</p>
<%= link_to_remote I18n.t('rubrics.member.new.criteria.add'),
:url => {:controller => :rubrics, :action => 'add_criterion'}, :method => :post,
:html => {:class => 'button add'},
:with => "$('rubric_form').serialize()" %>
<%= link_to_remote I18n.t('rubrics.member.new.levels.add'),
:url => {:controller => :rubrics, :action => 'add_level'}, :method => :post,
:html => {:class => 'button add'},
:with => "$('rubric_form').serialize()" %>
<table class="tableB">
    <% unless @rubric.levels.blank? %>
    <thead>
        <tr>
            <td>
            </td>
            <th colspan=<%=@rubric.levels.size%>
                class="level"><%= I18n.t('rubrics.member.new.levels.title') %>
            </th>
        </tr>
    </thead>
    <% end %>
    <tbody>
        <tr>
            <% unless @rubric.criteria.blank? %>
            <th class="criterion">
                <%= I18n.t('rubrics.member.new.criteria.title') %>
            </th>
            <% end %>
            <% i = 0 %>
            <% f.fields_for :levels do |l| %>
            <th class="level">
                <span class="editable"><%= @rubric.levels[i].name ? @rubric.levels[i].name : "Enter level name" %></span>
                <%= l.text_field :name, :placeholder => "level name" , :class => "field",  :style => "display: none;" %>
                <%= l.hidden_field :position, :value => i %>
                <%= link_to_remote image_tag("jeditable/delete.gif"),
                :url => {:controller => :rubrics, :action => 'remove_field', :position => i,:type => 'level' }, :method => :post,
                :with => "$('rubric_form').serialize()" %>
                <% i+= 1 %>
            </th>
            <% end %>
        </tr>
        <% j = 0 %>
        <% f.fields_for :criteria do |c| %>
        <tr>
            <th class="criterion">
                <span class="editable"><%= @rubric.criteria[j].name ? @rubric.criteria[j].name : "Enter criterion name" %></span>
                <%= c.text_field :name, :title => "criterion name", :placeholder => "criterion name" , :class => "field",  :style => "display: none;" %>
                <%= link_to_remote image_tag("jeditable/delete.gif"),
                :url => {:controller => :rubrics, :action => 'remove_field', :position => j,:type => 'criterion'  }, :method => :post,
                :with => "$('rubric_form').serialize()" %>
            </th>
            <% k = 0 %>
            <% c.fields_for :rubric_descriptors do |rd| %>
            <td>
                <span class="editable"><%= @rubric.criteria[j].rubric_descriptors[k].description ? @rubric.criteria[j].rubric_descriptors[k].description : "Type description here.." %></span>
                <%= rd.text_area :description, :placeholder => "Type description here..." , :class => "field",  :style => "display: none;" %>
                <%= rd.hidden_field :position, :value => k %>
                <% k+= 1 %>
            </td>
            <% end %>
        </tr>
        <% j+= 1 %>
        <% end %>
    </tbody>
</table>

<%= submit_tag :create %>
<% end %>